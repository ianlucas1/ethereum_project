# Threat Model

<!-- TODO: SME to conduct a more formal and detailed threat modeling exercise (e.g., using STRIDE or a similar methodology) if the project's risk profile increases.
This initial model covers common threats for a data analysis pipeline.
-->

This document outlines potential threats to the `ethereum_project`, their potential impact, and planned or existing mitigations. As a batch data analysis pipeline rather than a continuously running service, its attack surface and threat profile differ from typical web applications.

## Scope

The scope of this threat model includes:
*   The Python codebase (`repo://src/`).
*   The data pipeline execution environment (local machine or Docker container).
*   Interaction with external data APIs.
*   Management of secrets and dependencies.
*   The CI/CD pipeline on GitHub Actions.

## Potential Threats & Mitigations

### 1. Compromise of Secrets (API Keys, Credentials)
*   **Threat Actors:** External attackers, malicious insiders.
*   **Attack Vector:**
    *   Accidental commit of `.env` file or secrets directly into the repository.
    *   Compromise of developer machines where `.env` files are stored.
    *   Leakage of GitHub Actions secrets if workflow permissions are overly broad or vulnerable actions are used.
*   **Impact:**
    *   Unauthorized access to and use of paid external APIs, leading to financial costs.
    *   Data exfiltration or manipulation via compromised API access.
    *   Reputational damage.
*   **Mitigations:**
    *   Strict policy of not committing secrets to Git; `.env` is in `repo://.gitignore`. (See `repo://docs/security/secret_policy.md`).
    *   Use of GitHub Encrypted Secrets for CI/CD, scoped appropriately.
    *   Principle of least privilege for API key permissions granted by external services.
    *   Regular (manual) review and rotation of API keys.
    *   Developer education on secure handling of secrets.

### 2. Vulnerable Python Dependencies
*   **Threat Actors:** Attackers exploiting known CVEs in third-party packages.
*   **Attack Vector:** Inclusion of a Python package with a known vulnerability in `requirements.txt` or `requirements-dev.txt`.
*   **Impact:**
    *   If the vulnerability is exploitable in the context of the pipeline, it could lead to:
        *   Arbitrary code execution in the pipeline's environment.
        *   Data corruption or exfiltration.
        *   Denial of service for the pipeline.
*   **Mitigations:**
    *   Dependency scanning using `safety` in CI (`repo://.github/workflows/static-security.yml`, `repo://.github/workflows/ci.yml`) and pre-commit hooks.
    *   Use of pinned dependencies via `repo://requirements-lock.txt` and `repo://requirements-runtime-lock.txt` to ensure consistent and vetted sets of packages.
    *   Regular review and updating of dependencies to patch known vulnerabilities.
    *   Subscribing to security advisories for critical dependencies.

### 3. Data Integrity and Authenticity from External APIs
*   **Threat Actors:** Malicious external API providers, Man-in-the-Middle (MitM) attackers (if HTTPS is not enforced or is compromised).
*   **Attack Vector:**
    *   External API provides intentionally manipulated or incorrect data.
    *   Data is altered in transit if not protected by TLS/HTTPS.
*   **Impact:**
    *   Incorrect analysis results, leading to flawed conclusions or decisions.
    *   Model mis-specification and poor performance.
*   **Mitigations:**
    *   Use reputable and trusted data sources.
    *   All API calls should use HTTPS.
    *   Data validation and sanity checks within `repo://src/data_processing.py` after fetching (e.g., checking for expected ranges, types, missing values).
    *   Consider cross-referencing critical data points with multiple sources if available (currently not a primary strategy).
    *   Monitoring for unexpected data patterns or shifts (currently a manual process).

### 4. Insecure Deserialization
*   **Threat Actors:** Attackers who can control files read by the application (e.g., malformed cache files if the cache directory is compromised).
*   **Attack Vector:** The application deserializes data from an untrusted or compromised source using an unsafe method (e.g., `pickle` with arbitrary data).
*   **Impact:** Potential for arbitrary code execution with the privileges of the pipeline.
*   **Mitigations:**
    *   Cache files generated by `repo://src/utils/cache.py` are stored locally and assumed to be within a trusted environment.
    *   Prefer safer serialization formats like Parquet (for DataFrames) or JSON over `pickle` where possible, especially if there's any chance of the data source being untrusted. (The current caching mechanism should be reviewed to ensure `pickle` is used judiciously).
    *   Ensure file permissions on cache directories are appropriately restricted.

### 5. Resource Exhaustion (External APIs or Local System)
*   **Threat Actors:** Accidental (bug in code) or intentional (if an attacker could influence inputs leading to excessive calls).
*   **Attack Vector:**
    *   Code making an excessive number of API calls in a short period.
    *   Processing extremely large datasets locally without proper resource management.
*   **Impact:**
    *   API rate-limiting or temporary/permanent bans from external services.
    *   Increased operational costs for metered APIs.
    *   Denial of service for the local machine running the pipeline (CPU, memory, disk exhaustion).
*   **Mitigations:**
    *   Robust caching of API responses implemented in `repo://src/utils/cache.py` to minimize redundant calls.
    *   Respect API rate limits (requires careful implementation in data fetching logic if not handled by client libraries).
    *   Efficient data handling with pandas, including releasing memory for large DataFrames when no longer needed.
    *   Monitoring resource usage during development and testing.

### 6. CI/CD Pipeline Vulnerabilities
*   **Threat Actors:** Attackers compromising the build process.
*   **Attack Vector:**
    *   Use of compromised or malicious GitHub Actions.
    *   Injection of malicious code into the build script.
    *   Secrets leakage from CI logs if not properly masked.
*   **Impact:**
    *   Compromise of the codebase or build artifacts.
    *   Leakage of secrets used in CI.
    *   Execution of arbitrary code within the CI runner.
*   **Mitigations:**
    *   Use official or well-vetted GitHub Actions. Pin actions to specific commit SHAs or versions.
    *   Regularly review workflow scripts (`repo://.github/workflows/`).
    *   Ensure GitHub automatically masks secrets in logs.
    *   Follow the principle of least privilege for tokens and permissions granted to workflows (e.g., `permissions` block in workflow files).

## Assumptions

*   The development environment and the system running the pipeline are generally trusted.
*   External data APIs are reasonably secure and use HTTPS.

This threat model is a living document and should be reviewed and updated periodically, especially when significant changes are made to the project's architecture, dependencies, or data sources. 